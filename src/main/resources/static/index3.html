<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>PPTX Gamma Destroyer</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');

    :root {
      --primary: #ff7eb3; /* –†–æ–∑–æ–≤—ã–π */
      --primary-dark: #ff4d94;
      --accent: #7afcff; /* –ì–æ–ª—É–±–æ–π */
      --text: #4a4a4a;
      --glass: rgba(255, 255, 255, 0.85);
    }

    body {
      font-family: 'Quicksand', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      /* –ê–Ω–∏–º–µ—à–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –Ω–∞ —Ñ–æ–Ω–µ */
      background: linear-gradient(135deg, #fff0f5 0%, #e6e9f0 100%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden; /* –ß—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Å–∫—Ä–æ–ª–ª –≤–±–æ–∫ */
    }

    /* --- –ê–ù–ò–ú–ï –î–ï–í–û–ß–ö–ò –ü–û –ë–û–ö–ê–ú --- */
    .anime-side {
      position: fixed;
      bottom: 0;
      height: 85vh; /* –í—ã—Å–æ—Ç–∞ 85% –æ—Ç —ç–∫—Ä–∞–Ω–∞ */
      z-index: -1; /* –ù–∞ –∑–∞–¥–Ω–µ–º –ø–ª–∞–Ω–µ */
      pointer-events: none; /* –ß—Ç–æ–±—ã —Å–∫–≤–æ–∑—å –Ω–∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ –∫–ª–∏–∫–∞—Ç—å, –µ—Å–ª–∏ —á—Ç–æ */
      transition: transform 0.3s;
    }

    .left-girl {
      left: -20px;
    }

    .right-girl {
      right: -20px;
    }

    /* –ü—Ä—è—á–µ–º –¥–µ–≤–æ—á–µ–∫ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∏ */
    @media (max-width: 1300px) {
      .anime-side { opacity: 0.3; height: 60vh; }
    }
    @media (max-width: 900px) {
      .anime-side { display: none; }
    }

    /* --- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ --- */
    #login-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .login-box {
      background: white;
      padding: 40px;
      border-radius: 25px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(255, 126, 179, 0.3);
      border: 2px solid var(--primary);
      max-width: 300px;
      animation: float 3s ease-in-out infinite;
    }

    /* --- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–°—Ç–µ–∫–ª–æ–º–æ—Ä—Ñ–∏–∑–º) --- */
    .container {
      width: 90%;
      max-width: 700px;
      margin-top: 50px;
      margin-bottom: 50px;
      background: var(--glass);
      backdrop-filter: blur(10px);
      border-radius: 30px;
      padding: 40px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.18);
      position: relative;
      z-index: 10;
    }

    h1 {
      color: var(--primary-dark);
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 0;
    }
    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }

    h3 {
      color: var(--primary-dark);
      border-bottom: 2px dashed var(--primary);
      padding-bottom: 5px;
      margin-top: 30px;
    }

    /* --- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è --- */
    input, select, button {
      padding: 12px 15px;
      border-radius: 12px;
      border: 2px solid #eee;
      font-family: 'Quicksand', sans-serif;
      font-weight: 600;
      outline: none;
      transition: 0.3s;
      box-sizing: border-box;
      width: 100%;
      margin-bottom: 10px;
    }
    input:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 8px rgba(255, 126, 179, 0.2);
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1.1em;
      margin-top: 5px;
    }
    button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 77, 148, 0.4);
    }

    .row { display: flex; gap: 10px; }
    .row button { width: auto; white-space: nowrap; }

    /* --- –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ --- */
    .upload-area {
      border: 3px dashed #ddd;
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      transition: 0.3s;
      background: rgba(255,255,255,0.5);
    }
    .upload-area:hover {
      border-color: var(--primary);
      background: rgba(255, 240, 245, 0.5);
    }

    #status-msg {
      font-weight: bold;
      min-height: 24px;
      margin-top: 10px;
    }

    /* --- –¢–∞–±–ª–∏—Ü–∞ --- */
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 10px; overflow: hidden; }
    th { background: var(--primary); color: white; padding: 12px; }
    td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
    tr:last-child td { border-bottom: none; }

    /* --- –§—É—Ç–µ—Ä --- */
    .footer-qa {
      margin-top: 40px;
      background: rgba(255,255,255,0.6);
      padding: 20px;
      border-radius: 15px;
      font-size: 0.9em;
      border-left: 5px solid var(--primary);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–ª–∞–≤–∞–Ω–∏—è –¥–ª—è –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞ */
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
  </style>
</head>
<body>

<!-- –ö–ê–†–¢–ò–ù–ö–ò (–õ–ï–í–ê–Ø –ò –ü–†–ê–í–ê–Ø) -->
<!-- –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã left.png –∏ right.png –ª–µ–∂–∞—Ç –≤ static -->
<img src="left.png" class="anime-side left-girl" alt="Anime Girl Left" onerror="this.style.display='none'">
<img src="right.png" class="anime-side right-girl" alt="Anime Girl Right" onerror="this.style.display='none'">

<!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
<div id="login-overlay">
  <div class="login-box">
    <h2 style="color: var(--primary-dark)">Konnichiwa!</h2>
    <p>–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ—Å—å, —Å–µ–º–ø–∞–π:</p>
    <input type="text" id="username-input" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º...">
    <button onclick="login()">–ù–∞—á–∞—Ç—å ‚ú®</button>
  </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container">
  <h1>PPTX Cleaner ‚ú®</h1>
  <div class="subtitle">–ú–∞–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤ Gamma AI</div>

  <div style="text-align: right; font-weight: bold; color: var(--primary-dark); margin-bottom: 10px;">
    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span id="user-display">–ì–æ—Å—Ç—å</span>
  </div>

  <!-- 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <h3>üõ†Ô∏è –ú–∞–≥–∏—è –ø–æ–¥–º–µ–Ω—ã (–ü—Ä–µ—Å–µ—Ç—ã)</h3>
  <p style="font-size: 0.9em;">–•–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç—å –ª–æ–≥–æ? –û—Å—Ç–∞–≤—å—Ç–µ "–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å". –•–æ—Ç–∏—Ç–µ –≤–ø–∏—Å–∞—Ç—å —Å–≤–æ—ë –∏–º—è? –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ—Å–µ—Ç!</p>

  <div class="row">
    <input type="text" id="new-preset-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. '–î–ª—è –õ–∞–±—ã')">
    <input type="text" id="new-preset-text" placeholder="–¢–µ–∫—Å—Ç (–Ω–∞–ø—Ä. '–°—Ç—É–¥–µ–Ω—Ç 10–≥—Ä.')">
    <button onclick="createPreset()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>

  <div style="margin-top: 15px;">
    <label><b>–ê–∫—Ç–∏–≤–Ω–æ–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ:</b></label>
    <select id="preset-select">
      <option value="">‚ú® –£–±—Ä–∞—Ç—å –ª–æ–≥–æ (—Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º)</option>
    </select>
  </div>

  <!-- 2. –ó–∞–≥—Ä—É–∑–∫–∞ -->
  <h3>üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é</h3>
  <div class="upload-area">
    <input type="file" id="file-input" accept=".pptx" style="border: none; background: transparent;">
    <br>
    <button onclick="uploadFile()" style="padding: 15px 40px; font-size: 1.2em; border-radius: 50px;">
      –û—á–∏—Å—Ç–∏—Ç—å –æ—Ç —Å–∫–≤–µ—Ä–Ω—ã! ‚öîÔ∏è
    </button>
    <div id="status-msg"></div>
  </div>

  <!-- 3. –¢–∞–±–ª–∏—Ü–∞ -->
  <h3>üèÜ –õ—É—á—à–∏–µ –æ—Ö–æ—Ç–Ω–∏–∫–∏</h3>
  <table id="stats-table">
    <thead><tr><th>–ò–º—è</th><th>–°–ø–∞—Å–µ–Ω–æ —Å–ª–∞–π–¥–æ–≤</th></tr></thead>
    <tbody></tbody>
  </table>

  <!-- 4. –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã -->
  <div class="footer-qa">
    <p><b>üå∏ –ó–∞—á–µ–º Java –∏ Docker?</b><br> Java (Spring) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–æ—â–Ω—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –±—ç–∫–µ–Ω–¥. Docker —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã", —á—Ç–æ–±—ã –≤—Å—ë –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π –∏ —Ä–∞–±–æ—Ç–∞–ª–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ –ª—é–±–æ–π –º–∞—à–∏–Ω–µ (Linux/Windows).</p>
    <p><b>üå∏ –ü–æ—á–µ–º—É –Ω–µ Windows?</b><br> Windows ‚Äî —Ç—è–∂–µ–ª–∞—è –∏ –∑–∞–∫—Ä—ã—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–∏—Ä–∞—é—Ç Linux –∑–∞ –≥–∏–±–∫–æ—Å—Ç—å –∫–æ–Ω—Å–æ–ª–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–æ–π –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–≤—è–∑—á–∏–≤–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Microsoft.</p>
    <p><b>üå∏ –ò–Ω—Ç–µ—Ä–µ—Å—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</b><br> Java-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (Spring), –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è (Docker/K8s) –∏, –≤–æ–∑–º–æ–∂–Ω–æ, —Ö–æ—Ä–æ—à–µ–µ –∞–Ω–∏–º–µ ;)</p>
  </div>
</div>

<script>
  const API = 'http://localhost:8080/api';
  let currentUser = null;

  // –í—Ö–æ–¥
  async function login() {
    const username = document.getElementById('username-input').value;
    if(!username) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è!");

    try {
      const res = await fetch(`${API}/login?username=${username}`, { method: 'POST' });
      const data = await res.json();

      currentUser = data.user;
      document.getElementById('user-display').innerText = currentUser.username;
      document.getElementById('login-overlay').style.display = 'none';

      loadPresets();
      loadStats();
    } catch (e) {
      alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ Docker.");
    }
  }

  // –ü—Ä–µ—Å–µ—Ç—ã
  async function loadPresets() {
    const res = await fetch(`${API}/presets?username=${currentUser.username}`);
    const presets = await res.json();
    const select = document.getElementById('preset-select');

    select.innerHTML = '<option value="">‚ú® –£–±—Ä–∞—Ç—å –ª–æ–≥–æ (—Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º)</option>';

    presets.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.replacementText;
      opt.innerText = `üìú ${p.title} ("${p.replacementText}")`;
      select.appendChild(opt);
    });
  }

  async function createPreset() {
    const title = document.getElementById('new-preset-title').value;
    const text = document.getElementById('new-preset-text').value;

    if(!title || !text) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è!");

    await fetch(`${API}/presets?username=${currentUser.username}`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ title: title, replacementText: text })
    });

    document.getElementById('new-preset-title').value = '';
    document.getElementById('new-preset-text').value = '';
    loadPresets();
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞
  async function uploadFile() {
    const fileInput = document.getElementById('file-input');
    const customText = document.getElementById('preset-select').value;
    const status = document.getElementById('status-msg');

    status.innerText = "‚è≥ –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞–≥–∏—é...";
    status.style.color = "#888";

    if(fileInput.files.length === 0) return alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    formData.append('username', currentUser.username);
    if(customText) formData.append('customText', customText);

    try {
      const res = await fetch(`${API}/clean`, { method: 'POST', body: formData });

      if(res.ok) {
        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "CLEANED_" + fileInput.files[0].name;
        document.body.appendChild(a);
        a.click();
        a.remove();

        status.innerHTML = "‚ú® <b>–£—Å–ø–µ—Ö!</b> –§–∞–π–ª —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è.";
        status.style.color = "#ff4d94"; // –Ø—Ä–∫–æ-—Ä–æ–∑–æ–≤—ã–π

        loadStats();
      } else {
        status.innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.";
        status.style.color = "red";
      }
    } catch (e) {
      console.error(e);
      status.innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏.";
    }
  }

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  async function loadStats() {
    const res = await fetch(`${API}/stats`);
    const users = await res.json();
    const tbody = document.querySelector('#stats-table tbody');
    tbody.innerHTML = '';

    users.slice(0, 5).forEach(u => {
      tbody.innerHTML += `<tr><td>${u.username}</td><td><b>${u.totalSlidesCleaned}</b></td></tr>`;
    });
  }
</script>
</body>
</html>