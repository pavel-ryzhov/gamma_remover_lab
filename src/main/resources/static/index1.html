<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>PPTX Gamma Destroyer</title>
    <style>
        :root {
            --primary: #ff0055;
            --bg: #0f0f1a;
            --card: #1a1a2e;
            --text: #e0e0e0;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        #login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .login-box {
            background: var(--card);
            padding: 40px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 20px var(--primary);
        }

        .container {
            width: 90%;
            max-width: 800px;
            margin-top: 20px;
        }
        h1 { color: var(--primary); text-shadow: 2px 2px 0 #fff; }

        .panel {
            background: var(--card);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        input, select, button {
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            border: none;
        }
        button {
            background: var(--primary);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        button:hover { transform: scale(1.05); box-shadow: 0 0 10px var(--primary); }
        input[type="text"], select { background: #2a2a40; color: white; border: 1px solid #444; }

        .work-area {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
        }
        .anime-img {
            max-width: 200px;
            border-radius: 10px;
            transition: 0.5s;
            filter: grayscale(80%);
        }
        .anime-active {
            filter: grayscale(0%) drop-shadow(0 0 15px var(--primary));
            transform: scale(1.1);
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #444; text-align: left; }
        th { color: var(--primary); }

        .footer-qa { font-size: 0.8em; color: #888; margin-top: 50px; padding: 20px; border-top: 1px solid #333; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2 style="color: var(--primary)">IDENTIFICATION</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–æ–∑—ã–≤–Ω–æ–π, –∞–≥–µ–Ω—Ç:</p>
        <input type="text" id="username-input" placeholder="Username...">
        <br><br>
        <button onclick="login()">ENTER SYSTEM</button>
    </div>
</div>

<div class="container">
    <header style="display: flex; justify-content: space-between; align-items: center;">
        <h1>GAMMA DESTROYER 3000</h1>
        <div id="user-display">Agent: <span style="color:var(--primary)">???</span></div>
    </header>

    <div class="panel">
        <h3>1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ä—É–∂–∏—è (–ü—Ä–µ—Å–µ—Ç—ã)</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" id="new-preset-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –î–∏–ø–ª–æ–º)">
            <input type="text" id="new-preset-text" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ–Ω—ã (–Ω–∞–ø—Ä. –ò–≤–∞–Ω–æ–≤)">
            <button onclick="createPreset()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç</button>
        </div>
        <hr style="border-color: #333">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∞—Ç–∞–∫–∏:</label>
        <select id="preset-select">
            <option value="">-- –£–±—Ä–∞—Ç—å –ª–æ–≥–æ (–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å) --</option>
        </select>
    </div>

    <div class="panel work-area">
        <div>
            <h3>2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–ª–∏ (PPTX)</h3>
            <input type="file" id="file-input" accept=".pptx">
            <br><br>
            <button onclick="uploadFile()" style="font-size: 1.2em; padding: 15px 30px;">
                DESTROY GAMMA AI
            </button>
            <p id="status-msg" style="color: gray; margin-top: 10px;"></p>
        </div>
        <!-- –ê–ù–ò–ú–ï –ö–ê–†–¢–ò–ù–ö–ê (–ó–∞–∫–∏–Ω—å —Ñ–∞–π–ª anime.png –≤ –ø–∞–ø–∫—É static) -->
        <img src="anime.png" alt="Anime Mascot" class="anime-img" id="anime-mascot"
             onerror="this.src='https://via.placeholder.com/200x300?text=Anime+Girl'">
    </div>

    <div class="panel">
        <h3>üèÜ –ó–∞–ª –°–ª–∞–≤—ã (–¢–æ–ø –æ—á–∏—Å—Ç–∏—Ç–µ–ª–µ–π)</h3>
        <table id="stats-table">
            <thead><tr><th>–ê–≥–µ–Ω—Ç</th><th>–û—á–∏—â–µ–Ω–æ —Å–ª–∞–π–¥–æ–≤</th></tr></thead>
            <tbody><!-- JS insert --></tbody>
        </table>
    </div>

    <div class="footer-qa">
        <h4>–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã (–¥–ª—è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π):</h4>
        <p><b>–ó–∞—á–µ–º Java –∏ Docker?</b> Java ‚Äî –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞. Docker ‚Äî —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î.</p>
        <p><b>–ü–æ—á–µ–º—É —è –Ω–µ–Ω–∞–≤–∏–∂—É Windows?</b> –ú–µ—à–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–ª–æ—Ö–∞—è –∫–æ–Ω—Å–æ–ª—å. Linux ‚Äî –≤—ã–±–æ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤.</p>
        <p><b>–ò–Ω—Ç–µ—Ä–µ—Å—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</b> Java, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥, Spring Boot –∏ –∞–Ω–∏–º–µ (—Å—É–¥—è –ø–æ –∑–∞–¥–∞–Ω–∏—é).</p>
    </div>
</div>

<script>
    const API = 'http://localhost:8080/api';
    let currentUser = null;

    async function login() {
        const username = document.getElementById('username-input').value;
        if(!username) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");

        try {
            const res = await fetch(`${API}/login?username=${username}`, { method: 'POST' });
            const data = await res.json();

            currentUser = data.user;
            document.getElementById('user-display').innerHTML = `Agent: <span style="color:#ff0055">${currentUser.username}</span>`;
            document.getElementById('login-overlay').style.display = 'none';

            loadPresets();
            loadStats();
        } catch (e) {
            alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º!");
        }
    }

    async function loadPresets() {
        const res = await fetch(`${API}/presets?username=${currentUser.username}`);
        const presets = await res.json();
        const select = document.getElementById('preset-select');

        select.innerHTML = '<option value="">-- –£–±—Ä–∞—Ç—å –ª–æ–≥–æ (–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å) --</option>';

        presets.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.replacementText;
            opt.innerText = `${p.title} ("${p.replacementText}")`;
            select.appendChild(opt);
        });
    }

    async function createPreset() {
        const title = document.getElementById('new-preset-title').value;
        const text = document.getElementById('new-preset-text').value;

        if(!title || !text) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è!");

        await fetch(`${API}/presets?username=${currentUser.username}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ title: title, replacementText: text })
        });

        document.getElementById('new-preset-title').value = '';
        document.getElementById('new-preset-text').value = '';
        loadPresets();
    }

    async function uploadFile() {
        const fileInput = document.getElementById('file-input');
        const customText = document.getElementById('preset-select').value;
        const status = document.getElementById('status-msg');
        const anime = document.getElementById('anime-mascot');

        if(fileInput.files.length === 0) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        formData.append('username', currentUser.username);
        if(customText) formData.append('customText', customText);

        status.innerText = "–ò–¥–µ—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –ò–ò...";

        try {
            const res = await fetch(`${API}/clean`, { method: 'POST', body: formData });

            if(res.ok) {
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "CLEANED_" + fileInput.files[0].name;
                document.body.appendChild(a);
                a.click();
                a.remove();

                status.innerText = "–£—Å–ø–µ—à–Ω–æ! –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å.";
                status.style.color = "#0f0";

                anime.classList.add('anime-active');
                setTimeout(() => anime.classList.remove('anime-active'), 2000);

                loadStats();
            } else {
                status.innerText = "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ.";
                status.style.color = "red";
            }
        } catch (e) {
            console.error(e);
            status.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏.";
        }
    }

    async function loadStats() {
        const res = await fetch(`${API}/stats`);
        const users = await res.json();
        const tbody = document.querySelector('#stats-table tbody');
        tbody.innerHTML = '';

        users.slice(0, 5).forEach(u => {
            tbody.innerHTML += `<tr><td>${u.username}</td><td>${u.totalSlidesCleaned}</td></tr>`;
        });
    }
</script>
</body>
</html>